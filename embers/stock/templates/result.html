{% extends 'base.html' %}
{% load static %}

{% block content %}

<!--Yiren 的 sim_trade/stock 在下面-->

<section class="bg-primary-3 text-white">
  <div class="container">
    <div class="row section-title justify-content-center text-center">
      <div class="col-md-9 col-lg-8 col-xl-7">
        <h4 class="display-4">The stock you searched:</h4>
      </div>
    </div>

  {% if message %}
    <div class="alert alert-warning alert-dismissable">
        <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
        <h4 class="text-center text-black-50">{{ message }}</h4>
    </div>
  {% endif %}

  {% if stocks_list %}
    <div class="row justify-content-center">
      <div class="col-xl-5 col-lg-9 col-md-10 mb-3 mb-sm-5" data-aos="fade-up" data-offset="200">
        {% for stockItem in stocks_list %}
        <div class="card card-body hover-box-shadow bg-white">
          <div>
{#              <h6 class="text-muted mb-3" style="float: right">CODE: {{ stockItem.symbol }}</h6>#}
              <h4>{{ stockItem.cmpname }}</h4>
              <h5 class="text-muted mb-3">CODE: {{ stockItem.symbol }}</h5>
          </div>

          <div>
              <p>current price: ${{ stockItem.price }}</p>
              <p>open price: ${{ stockItem.open }}</p>
              <p>close price: ${{ stockItem.close }}</p>
              <p>high price: ${{ stockItem.high }}</p>
              <p>low price: ${{ stockItem.low }}</p>
          </div>

          <div>
            <a href="{% url 'stock:stock' stockItem.symbol %}" class="lead" style="float: right">More details</a>
          </div>


{#              {% if stock_item.1.logo %}#}
{#                  <img src="{{ stock_item.1.logo }}" alt="company logo" class="avatar mt-md-n5 mb-3">#}
{#              {% else %}#}
{#                  <img src="{% static 'img/empty.png' %}" alt="company logo" class="avatar mt-md-n5 mb-3">#}
{#              {% endif %}#}


        {% comment %}
          <div>
            <a href="{{ stock_item.1.weburl }}" class="card-link">
              <h3 class="h3">{{ stock_item.1.name}}</h3>
            </a>
            <h5>current price: ${{ stock_item.0.c }}</h5>
            <h5>price in the previous day: ${{ stock_item.0.pc }}</h5>
            <h5>low price today: ${{ stock_item.0.l }}</h5>
            <h5>high price today: ${{ stock_item.0.h }}</h5>

            <a href="{% url 'stock:stock' stock_item.1.ticker %}" class="lead">Check more</a>





{#                <div class="accordion" id="more_about_stock">#}
{#                  <button class="btn btn-link" type="button" data-toggle="collapse"#}
{#                          data-target="#collapse_more_about" aria-expanded="false" aria-controls="collapse_more_about">#}
{#                    Check more#}
{#                  </button>#}
{#                </div>#}
{##}
{#                <div id="collapse_more_about" class="collapse" aria-labelledby="more_about_stock">#}
{#                    <p>Country: {{ stock_item.1.country }}</p>#}
{#                    <p>Currency: {{ stock_item.1.currency }}</p>#}
{#                    <p>Exchange: {{ stock_item.1.exchange }}</p>#}
{#                    <p>Industry: {{ stock_item.1.finnhubIndustry }}</p>#}
{#                    <p>Share: ${{ stock_item.1.shareOutstanding }}</p>#}
{#                    <p>IPO date: {{ stock_item.1.ipo }}</p>#}
{#                    <p>Phone: {{ stock_item.1.phone }}</p>#}
{#                    <p>Website: {{ stock_item.1.weburl }}</p>#}
{#                </div>#}
          </div>


        {% endcomment %}

            {% if request.session.user_id %}
              <div class="card-body text-center">
                <!-- Button trigger modal -->
{#                <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#follow_modal">#}
{#                    Follow#}
{#                </button>#}
                <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#follow_modal"
                        onClick="follow_confirm('/sim_trade/post_follow/{{ stockItem.symbol }}')">
                    Follow
                </button>
              </div>
            {% endif %}
        </div><!--inside the card-->
        <br/>
        <br/>
        {% endfor %}

      </div>
    </div>
  </div>
  {% endif %}

{#        <div class="row justify-content-center">#}
{#            <a class="btn btn-primary btn-lg" href="/sim_trade" role="buttton">Go back</a>#}
{#        </div>#}

{#        <div class="card-body text-center">#}
{#            <form action="{% url 'sim_trade:post_follow' stock_item.1.ticker %}" method="post">#}
{#                {% csrf_token %}#}
{#                <input class="btn btn-primary" type="submit" value="Follow"></input>#}
{#            </form>#}
{#        </div>#}

    <!-- Modal -->
    <div class="modal fade" id="follow_modal" tabindex="-1" role="dialog" aria-labelledby="follow_modalTitle" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
          <div class="modal-body">
              <h4 class="text-black-50">Sure to add to watchlist?</h4>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
{#                <form action="/sim_trade/post_follow/" method="post">   # {{  }}#}
{#                <form action="{% url 'stock:post_follow' stockItem.symbol %}" method="post">#}
{#                    {% csrf_token %}#}
{#                    <input class="btn btn-primary" type="submit" value="Follow"></input>#}
{#                </form>#}
            <input type="hidden" id="url_follow"/>
            <a onclick="urlSubmit()" class="btn btn-primary">Follow</a>
          </div>
        </div>
      </div>
    </div>



</section>

<script>
function follow_confirm(url) {
      $('#url_follow').val(url);//给会话中的隐藏属性URL赋值
      {#console.log(url);#}
}

function urlSubmit(){
   var url=$("#url_follow").val();//获取会话中的隐藏属性URL
   window.location.href=url;
    {#console.log(url);#}
}
</script>





{% endblock %}
